<div class="card" id="transaction-card">
  <header class="card-header has-background-primary">
    <%= content_tag :p, class: "card-header-title has-text-white", data: { tooltip: @transaction.description } do -%>
      <%= @transaction.trx_desc_display %>      
    <% end %>
    <p class="card-header-icon has-text-white has-text-weight-bold">
      <%= @transaction.trx_date_display %>
    </p>
  </header>

  <div class="card-content">
    <div class="content">
      <div class="columns is-multiline">

        <div class="column is-6 has-text-centered-mobile has-text-left">
          <p class="title is-6 has-text-link">
            Amount
          </p>
          <p class="subtitle pt-5 mb-0 is-2 <%= @transaction.amount_color %>">
            <%= @transaction.amount_decorated %>
            <div class="is-size-7 has-text-grey-light">Created <%= @transaction.created_at_decorated %></div>
          </p>

          <!-- Memo -->
          <p class="">
            <div class="title is-6 has-text-link">Memo</div>
            <div class="subtitle is-size-6 mb-0 has-text-grey"><%= @transaction.memo_decorated %></div>
          </p>

        </div>

        <div class="column is-6 has-text-centered-mobile has-text-right">
          <!-- Attachments -->
          <p class="title mb-5 is-6 has-text-link">
            Attachments
          </p>
          <div class="title is-7">
            <% if @transaction.attachments.attached? then %>
              <div class="attachment-links">
                <% @transaction.attachments.each do |attachment| %>
                  <div class="mb-2">
                    <%= link_to url_for(attachment), 
                                target: '_blank',
                                class: 'has-text-link',
                                title: "#{attachment.filename} (#{number_to_human_size(attachment.byte_size)})" do %>
                      <span><%= attachment.filename %></span>
                      <span class="icon is-small ml-1">
                        <i class="fas fa-external-link-alt"></i>
                      </span>
                    <% end %>
                  </div>
                <% end %>
              </div>
            <% else %>
              <p>
                <span class="tag is-dark has-text-weight-bold">
                  No attachments
                </span>
              </p>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>

  <% if @transaction.transfer? %>
    <div class="card-content">
      <div class="content">
        <% if @transaction.account_to_account? && @transaction.counterpart_transaction.present? %>
          <% counterpart = @transaction.counterpart_transaction %>
          <div class="box">
            <p class="title is-4 mb-4">
              Linked Transaction
            </p>
            <p class="mb-1">
              <strong>Account:</strong> <%= counterpart.account.name %>
            </p>
            <p class="mb-1">
              <strong>Date:</strong> <%= counterpart.trx_date.strftime("%m/%d/%Y") %>
            </p>
            <p class="mb-1">
              <strong>Amount:</strong> <span class="<%= counterpart.amount.negative? ? 'has-text-danger' : 'has-text-success' %>">
                <%= number_to_currency(counterpart.amount.abs) %>
              </span>
            </p>
            <p class="mb-1">
              <strong>Description:</strong> <%= counterpart.description %>
            </p>
            <p class="mt-3">
              <%= link_to "View Transaction", account_transaction_path(counterpart.account, counterpart), 
                  class: "button is-small is-link", 
                  data: { turbo_frame: "_top" } %>
            </p>
          </div>
        <% elsif @transaction.account_to_stash? && @transaction.stash_entry.present? %>
          <% stash_entry = @transaction.stash_entry %>
          <div class="box">
            <p class="title is-4 mb-4">
              Linked Transaction
            </p>
            <p class="mb-1">
              <strong>Stash:</strong> <%= stash_entry.stash.name %>
            </p>
            <p class="mb-1">
              <strong>Date:</strong> <%= stash_entry.stash_entry_date.strftime("%m/%d/%Y") %>
            </p>
            <p class="mb-1">
              <strong>Amount:</strong> <span class="<%= stash_entry.amount.negative? ? 'has-text-danger' : 'has-text-success' %>">
                <%= number_to_currency(stash_entry.amount.abs) %>
              </span>
            </p>
            <p class="mb-1">
              <strong>Description:</strong> <%= stash_entry.description %>
            </p>
            <p class="mt-3">
              <%= link_to "View Stash", account_stash_path(stash_entry.stash.account, stash_entry.stash), 
                  class: "button is-small is-link", 
                  data: { turbo_frame: "_top" } %>
            </p>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <% if !@transaction.locked || @transaction.transfer? %>
    <footer class="card-footer">
      <!-- Links -->
      <%= link_to edit_account_transaction_path(@transaction.account, @transaction), class: 'card-footer-item has-text-weight-bold' do %>Edit<% end %>
      <% unless @transaction.transfer? %>
        <a 
          class="card-footer-item has-text-weight-bold modal-button" 
          data-action="click->shared#toggleModal"
          data-id="delete-transaction-<%= @transaction.id %>"
        >
          Delete
        </a>
      <% end %>
    </footer>
  <% end %>
</div>

<%= render partial: "transactions/components/deleteModal" %>