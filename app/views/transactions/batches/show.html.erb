<% content_for :title, "Transaction Batch" %>

<div class="container ob-compact-container">
  <div class="level">
    <div class="level-left">
      <div class="level-item">
        <h1 class="title is-4">Batch for <%= @batch.month_label %></h1>
      </div>
    </div>
    <div class="level-right">
      <div class="level-item">
        <div class="buttons">
          <%= link_to "All batches", transactions_batches_path, class: "button is-link" %>
          <%= link_to "Bills", bills_path, class: "button is-light" %>
        </div>
      </div>
    </div>
  </div>

  <div class="box">
    <div class="columns is-variable is-2">
      <div class="column">
        <p class="heading">Period</p>
        <p class="title is-6 mb-0"><%= @batch.month_label %></p>
      </div>
      <div class="column">
        <p class="heading">Created</p>
        <p class="title is-6 mb-0"><%= l @batch.created_at, format: :long %></p>
      </div>
      <div class="column">
        <p class="heading">Transactions</p>
        <p class="title is-6 mb-0"><%= @batch.transactions_count %></p>
      </div>
      <div class="column">
        <p class="heading">Total amount</p>
        <p class="title is-6 mb-0"><%= number_to_currency(@batch.total_amount) %></p>
      </div>
      <div class="column">
        <p class="heading">Reference</p>
        <p class="title is-6 mb-0"><%= @batch.reference %></p>
      </div>
    </div>
    <% if @transactions.all?(&:pending?) %>
      <div class="mt-3">
        <%= button_to "Undo batch",
                      transactions_batch_path(@batch),
                      method: :delete,
                      class: "button is-danger",
                      data: { turbo_confirm: "Remove all pending transactions in this batch?" } %>
      </div>
    <% end %>
  </div>

  <% if @transactions.any? %>
    <div class="table-container">
      <table class="table is-fullwidth is-striped is-hoverable">
        <thead>
          <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Account</th>
            <th>Status</th>
            <th class="has-text-right">Amount</th>
          </tr>
        </thead>
        <tbody>
          <% @transactions.each do |transaction| %>
            <tr>
              <td><%= l transaction.trx_date, format: :short %></td>
              <td><%= transaction.description %></td>
              <td><%= transaction.account.name %></td>
              <td><%= transaction.pending? ? "Pending" : "Reviewed" %></td>
              <td class="has-text-right"><%= number_to_currency(transaction.amount) %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="notification is-light">
      No transactions found for this batch.
    </div>
  <% end %>
</div>


