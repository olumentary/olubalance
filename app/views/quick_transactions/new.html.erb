<div class="container">
  <div class="columns is-centered">
    <div class="column is-half">
      <div class="box">
        <h1 class="title is-4">Quick Receipt Upload</h1>
        
        <%= form_with(model: @transaction, url: quick_transactions_path, local: true, multipart: true, data: { controller: "quick-receipt" }) do |f| %>
          <% if @transaction.errors.any? %>
            <div class="notification is-danger">
              <div class="content">
                <ul>
                  <% @transaction.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            </div>
          <% end %>

          <div class="field">
            <%= f.label :account_id, "Account", class: "label" %>
            <div class="control">
              <div class="select is-fullwidth <%= 'is-danger' if @transaction.errors[:account_id].any? %>">
                <%= f.collection_select :account_id, @user_accounts, :id, :name, 
                                        { prompt: "Select an account..." }, 
                                        { selected: @transaction.account_id } %>
              </div>
              <% if @transaction.errors[:account_id].any? %>
                <p class="help is-danger"><%= @transaction.errors[:account_id].join(', ') %></p>
              <% end %>
              <% if current_user.default_account_id.present? && @transaction.account_id == current_user.default_account_id %>
                <p class="help is-info">
                  <span class="icon">
                    <i class="fas fa-info-circle"></i>
                  </span>
                  Default account selected based on your settings. You can change this if needed.
                </p>
              <% end %>
            </div>
          </div>

          <div class="field">
            <%= f.label :attachments, "Receipt", class: "label" %>
            <div class="control">
              <%= f.file_field :attachments, 
                              multiple: true,
                              class: "input #{'is-danger' if @transaction.errors[:attachments].any?}", 
                              accept: "image/*,.pdf",
                              data: { 
                                quick_receipt_target: "attachment",
                                action: "change->quick-receipt#attachmentSelected"
                              } %>
              <% if @transaction.errors[:attachments].any? %>
                <p class="help is-danger"><%= @transaction.errors[:attachments].join(', ') %></p>
              <% end %>
              <p class="help is-danger is-hidden" data-quick-receipt-target="error"></p>
            </div>
          </div>

          <div class="field">
            <div class="control">
              <%= f.submit "Upload Receipt", 
                          class: "button is-primary is-fullwidth",
                          data: { quick_receipt_target: "submit" } %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div> 